---
timestamp: 'Sat Oct 18 2025 18:45:49 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251018_184549.1854cee2.md]]'
content_id: 07b7d9eb43e640d495841e0f0b7d74e9a25fb35a00044a3aa33e48e3373aa880
---

# Note

Here are some notes that worth highlighting when testing this concept:

1. For the purpose of separation of concerns and maintaining modularity between concepts, AdaptiveSchedule's requestAdaptiveScheduleAI action takes a `contexted_prompt` string as input, which is the prompt we feed the LLM with the necessary context. When implementing the app later, we will formulate `contexted_prompt` in syncs. Since right now we are only implementing the concept, we treat it as input for the actions. But for the ease of implementing syncs later on, in test cases, we want to make sure that these inputs behave as what we want. In particular, the `context` in `contexted_prompt` refers to Task, Schedule, and Routine, and preferences:

* Task refers to the set of tasks specified by the user. It is managed under the`TaskCatalog` concept and has the following structure:

```
  a set of Tasks with
    an owner User
    a taskId String
    a taskName String
    a category String
    a duration Duration
    a priority Number
    a splittable Flag
    a timeBlockSet containing a set of Strings (optional) // these strings are unique ids for timeBlocks
    a deadline TimeStamp (optional)
    a slack Number (optional) // buffer margin in minutes for acceptable deviation
    a preDependence set of Tasks (optional) // tasks that it depends on
    a postDependence set of Tasks (optional) // tasks that depend on it
    a note String (optional)
```

* Schedule refers to the set of time blocks, and it is the user's intended/planned allocation of tasks under each time block. It is managed under the ScheduleTime concept and has the following structure:

```
  a set of TimeBlocks with
    a timeBlockId String // this is a unique id
    an owner User
    a start TimeStamp
    an end TimeStamp
    a taskIdSet set of Strings // contains unique ids identifying tasks
```

* Routine refers to the set of sessions, and it is the user's actual recorded routine of the day (i.e., what they actually did). It is managed under the RoutineLog concept and has the following structure:

```
  a set of Sessions with
    an owner User
    a sessionName String
    a sessionId String    // this is an unique ID
    an isPaused Flag
    an isActive Flag
    a start TimeStamp (optional)
    an end TimeStamp (optional)
    a linkedTaskId String (optional)  // this is the unique id identifying tasks
    an interruptReason String (optional)
```

* Preferences refer to a string that specifies the user's preferences for the schedule. Examples are "Prefer to work on high-priority tasks in the morning when fresh" or "Exercise in late afternoon or early evening. Avoid scheduling demanding work after 9 PM. Prefer to batch similar tasks together."

2. When implementing the test cases, you should generate sample instances of Tasks, TimeBlocks, Sessions, and preferences. Then, you should define a function that generate the `contexted_prompt`, and pass in the generated `contexted_prompt` string to the requestAdaptiveScheduleAI action. This is the function I want you to use, you MUST keep the exact structure of the prompt, but you can adjust this function so that it works well with the implemented actions:

```typescript
  private createAdaptiveSchedulePrompt(
  owner: User,
  tasks: Task[],
  schedule: Schedule,
  routine: Routine,
  preference: Preference,
  currentTime?: string
): string {
  const existingBlocksSection =
    this.adaptiveBlocks.filter((b) => b.owner === owner).length > 0
      ? `\nEXISTING ADAPTIVE BLOCKS:\n${this.adaptiveBlocksToString(owner)}\n`
      : "";

  const currentTimeSection = currentTime
    ? `\nCURRENT TIME: ${currentTime}\n** CRITICAL: You MUST schedule all time blocks to start at or after this current time. Do NOT schedule anything before ${currentTime}. **`
    : "";

  return `
  You are a helpful AI assistant that creates optimal adaptive schedules for users based on task analysis, planned schedules, actual routines, and user preferences.

  USER: ${owner}
  ${currentTimeSection}

  USER PREFERENCES:
  ${preference.preferences.map((p) => `- ${p}`).join("\n")}

  TASKS TO SCHEDULE:
  ** CRITICAL: ALL tasks listed below MUST be scheduled. Each task represents work that still needs to be done. **
  ** If a task has a note indicating "remaining" work, schedule exactly the duration specified. **
  ${this.tasksToString(tasks)}

  PLANNED SCHEDULE (Original Plan):
  ${this.scheduleToString(schedule)}

  ACTUAL ROUTINE (What Actually Happened):
  ${this.routineToString(routine)}

  EXISTING ADAPTIVE BLOCK:
  ${existingBlocksSection}

  TASK PRIORITY SCALE (1-5), determines how urgent the task is:
  - Priority 1 (Critical): Must be done ASAP - urgent deadlines, emergencies
  - Priority 2 (Important): Should be done soon - upcoming deadlines, high impact
  - Priority 3 (Regular): Necessary but not urgent
  - Priority 4 (Low): Can be done later
  - Priority 5 (Optional): Can be done if time permits - not time-sensitive or important

  ANALYSIS REQUIREMENTS:
  1. Analyze the deviation between the planned schedule and actual routine
  2. Identify tasks that were not completed or were interrupted
  3. Consider task priorities (1 = highest priority, 5 = lowest priority), deadlines, and dependencies
  4. Schedule critical tasks (priority 1-2) before lower priority tasks
  5. Consider user preferences for scheduling
  6. Respect task constraints (duration, splittable, slack)
  7. **CONCURRENCY OPTIMIZATION (ALWAYS APPLY): Whenever you have a PASSIVE/BACKGROUND task (laundry, dishwashing - tasks that run automatically), you MUST ALWAYS schedule it concurrently with an active task by creating OVERLAPPING time blocks. This is MANDATORY, not optional. Active tasks (cleaning room, organizing notes, studying) CANNOT be done concurrently with each other. RULE: If you see "Do Laundry" or "Dishwashing", immediately find an active task to overlap it with.**

  SCHEDULING CONSTRAINTS:
  - Times must be in ISO 8601 format (e.g., "2025-10-04T14:00:00Z")
  - Start time must be before end time
  - ALL time blocks MUST start at or after the CURRENT TIME if provided
  - **CRITICAL DURATION RULE: Each time block's duration MUST be at least as long as the longest task in that block (NOT the sum). When tasks are concurrent/overlapping in separate blocks, each block is evaluated independently.**
  - For non-splittable tasks, the block must be at least as long as the task duration
  - For splittable tasks, you can either: (1) create a single block with duration >= task duration, OR (2) split across multiple blocks where sum of block durations >= task duration
  - **CONCURRENCY CLARIFICATION: When creating overlapping blocks, each block duration only needs to match its own task duration. Example: Laundry (60 min) in Block A from 1:40-2:40 PM, Study (120 min) in Block B from 1:40-3:40 PM - this is CORRECT and maximizes time savings.**
  - High priority tasks should be scheduled first
  - Respect task deadlines
  - Consider dependencies (preDependence tasks must be scheduled before dependent tasks)
  - If a task is splittable, it can be divided across multiple blocks. Otherwise, do not divide it across multiple **non-consecutive blocks**.
  - **MANDATORY: You MUST ALWAYS create overlapping/concurrent blocks for passive tasks (laundry, dishwashing, etc.). This means creating separate blocks with the same or overlapping time ranges. For example, if you have laundry and studying, ALWAYS create two blocks that overlap in time - NEVER schedule passive tasks sequentially. This is required even if you have enough time, as it frees up time for additional tasks.**

  CRITICAL REQUIREMENTS:
  1. ONLY schedule the tasks listed above - do NOT add any new tasks
  2. Ensure all scheduled blocks have valid ISO timestamps
  3. Assign tasks based on priority and deadline urgency
  4. **ABSOLUTE DEADLINE CONSTRAINT: If a task has a deadline, it MUST be completed BEFORE that deadline. Do NOT schedule any part of the task after its deadline.**
  5. **If there is insufficient time to complete all tasks before their deadlines, prioritize higher priority tasks first**
  6. **DURATION CONSTRAINT (FLEXIBLE WHEN CONSTRAINED): Ideally give each task its FULL required duration. However, when time is severely constrained and you have leftover time that can't fit a full task, it's acceptable to schedule a partial task duration rather than leaving the time empty. For example, if you have 20 minutes left and a 60-minute task, schedule it for 20 minutes rather than dropping it entirely.**
  7. Consider the actual routine and how it deviates from the schedule to understand what time blocks are realistic
  8. Provide reasoning for why actual routine deviated from the original planned schedule
  9. For a task with a long duration and is splittable, consider splitting it into multiple non-consecutive time blocks for better focus
  10. If time is insufficient to schedule all tasks, prioritize tasks with urgent deadlines (approaching soon) or higher priority (1-2); only drop tasks if absolutely no time remains

  Return your response as a JSON object with this exact structure:
  {
  "analysis": "Brief analysis of why the schedule deviated from the routine and key insights",
  "adaptiveBlocks": [
      {
      "start": "ISO timestamp",
      "end": "ISO timestamp",
      "taskIds": ["taskId1", "taskId2"]
      }
  ],
  "droppedTaskIds": ["taskId3", "taskId4"]
  }

  EXAMPLE 1 - Deadline constraint:
  - If task-1 has deadline at 5 PM and current time is 12 PM
  - Available time: 5 hours (300 minutes)
  - If task-1 needs 100 min + other high priority tasks need 200 min = 300 min total
  - Low priority tasks (task-5, task-6) CANNOT fit before deadline
  - CORRECT: Put task-5 and task-6 in droppedTaskIds
  - WRONG: Schedule tasks after the 5 PM deadline

  EXAMPLE 2 - Concurrency optimization (ALWAYS REQUIRED FOR PASSIVE TASKS):
  - Laundry (60 min, PASSIVE) + Study (120 min, ACTIVE)
  - MANDATORY APPROACH: Always overlap passive tasks - create these blocks:
    Block A: {"start": "2025-10-04T14:00:00Z", "end": "2025-10-04T15:00:00Z", "taskIds": ["laundry-task-id"]},
    Block B: {"start": "2025-10-04T14:00:00Z", "end": "2025-10-04T16:00:00Z", "taskIds": ["study-task-id"]}
  - Result: Both complete by 4:00 PM, saving 60 minutes for other tasks
  - WRONG: Scheduling laundry sequentially (3:40-4:40) after studying wastes 60 minutes
  - WRONG: Clean Room + Organize Notes overlapping (both ACTIVE - cannot be concurrent)
  - WRONG: Any scheduling that extends past the deadline

  Return ONLY the JSON object, no additional text.`;
}
```
